<section class="windfury">
	<section class="episodes">
        <div>
            <select class="years">
                <option value="1985">1985</option>
                <option value="1986">1986</option>
                <option value="1987">1987</option>
            </select>

            <div class="list"></div>
        </div>
	</section>

	<script>
        (function($, wf){
            $.wf(['template/base.html'], function(base){
                var page = wf.doT(".episodes");
                
                function open(){

                    function list() {
                        var year = querystring().get('year');
                        if (!year) {
                            year = $('.years option:selected').val();
                        }
                        
                        $.post('/s/Episode/find', JSON.stringify({
                            "year" : year
                        }), function(result) {
                            var table = $('<table/>');
                            var header = '<tr><th>ID</th><th>Acao</th></tr>';
                            table.append(header);

                            result.forEach(function(episode) {
                                var id = '<td>' + episode.id + '</td>';

                                var acao;
                                if (episode.transcripted) {
                                    acao = '<td><a href="#Episode?episodeId=' + episode.id + '">Ver</a></td>';
                                } else {
                                    acao = '<td><a href="#Transcription?id=' + episode.id + '">Transcrever</a></td>';
                                }

                                table.append('<tr>' + id + acao + '</tr>');
                            });

                            $('.list').html(table);
                        });
                    }
                    
                    base.open(page());
                    var year = querystring().get('year');
                    if (year) {
                        $('.years').val(year);
                    }

                    list();

                    $('select.years').change(function() {
                        location.hash = "#Episodes?year=" + $('.years option:selected').val();
                    });
                    
                }
                
                wf.def({
                    open : open
                });
            });
        })(jQuery, windfury);
	</script>
</section>