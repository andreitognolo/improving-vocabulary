<section class="page">
	<section class="transcription">
			<div class="episode"></div>
			
			<div class="sentences"></div>
			<div>
				<button type="button" class="next btn btn-success">Proxima</button>
			</div>
	</section>
	
	<script>
		function next() {
			var episodeId = querystring().get('episodeId');
			if (!episodeId) {
				episodeId = 1;
			}
				
			$.post('/s/Episode/next', JSON.stringify({previousEpisodeId: episodeId}), function(episode) {
				location = location.href.split('?')[0] + '?episodeId=' + episode.id;
			});
		}
		
		(function open() {
			var episodeId = querystring().get('episodeId');
			if (!episodeId) {
				next();
				return;
			}
			$('.episode').html('');
			$.post('/s/Episode/find', JSON.stringify({id: episodeId}), function(episodes) {
				var episode = episodes[0];
				$('.episode').append($('<img src="img/calvin-hobbes/' + episode.id + '.gif" />'));
				
				if (episode.sentences) {
					episode.sentences.forEach(function(sentence) {
						var p = $('<p>');
						var character = sentence.character;
						var sentence = sentence.sentence;
						p.html('<strong>' + character + '</strong>: ' + sentence);
						
						$('.sentences').append(p);
					});
				} else {
					$.warning('Esse episodio ainda nao foi transcrito!', 10000);
				}
				
				$('.next').click(next);
			});
		})();
	</script>
</section>