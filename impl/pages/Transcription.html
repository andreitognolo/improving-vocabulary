<section class="page">
	<section class="transcription">
		<div class="episode"></div>

		<form class="form-inline" role="form">
			<div class="new-sentence">
				<div class="form-group">
					<select id="character" class="character form-control">
						<option value="CHOOSE">Escolha o personagem...</option>
						<option value="CALVIN">Calvin</option>
						<option value="HOBBES">Hobbes</option>
						<option value="PAI">Pai</option>
						<option value="MAE">Mae</option>
						<option value="SUSY">Susy</option>
						<option value="PROFESSORA">Professora</option>
						<option value="OTHER">Outros</option>
					</select>
				</div>
				<div class="form-group">
					<label class="sr-only" for="sentence">Fala</label> <input
						type="text" id="sentence" class="sentence form-control"
						placeholder="Digite aqui a fala do personagem">
				</div>
				<div class="form-group">
					<button type="submit" class="add btn btn-primary">Adicionar</button>
				</div>
			</div>
		</form>

		<div>
			<button type="button" class="save btn btn-success">Salvar</button>
		</div>
	</section>

	<script>
		(function open() {
			$('.episode').html('');
			$('.form-inline p').remove();

			var id = querystring().get('id');
			if (!id) {
				$.get('/s/Episode/nextTranscription', function(id) {
					location.hash = "#Transcription?id=" + id;
				});
				return;
			}
			
			$('.episode').append($('<img src="img/calvin-hobbes/' + id + '.gif" />'));

			$('.add').click(function() {
				var p = $('<p>');
				var character = $('.character').val();
				var sentence = $('.sentence').val();
				p.html('<strong>' + character + '</strong>: ' + sentence);
				p.data('character', character);
				p.data('sentence', sentence);

				p.insertBefore($('.new-sentence'));

				$('.character').val('CHOOSE');
				$('.sentence').val('');

				return false;
			});

			$('.save').click(function() {
				var sentences = [];
				$('p').each(function() {
					sentences.push({
						'character' : $(this).data('character'),
						'sentence' : $(this).data('sentence')
					});
				});

				var episode = {
					id : id,
					sentences : sentences
				}

				$.post('/s/Episode/saveTranscription', JSON.stringify(episode)).complete(function(result) {
					$.success('Episodio salvo com sucesso');
					location.hash = "#Transcription";
				});
			});
		})();
	</script>
</section>